<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MP3 Player</title>
  <style>
    :root{
      --bg: #0b1220;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.6);
      --line: rgba(255,255,255,.12);
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{ box-sizing: border-box; }
    body{
      margin:0;
      min-height:100vh;
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1200px 700px at 20% 15%, rgba(99,102,241,.35), transparent 55%),
        radial-gradient(900px 600px at 80% 30%, rgba(16,185,129,.22), transparent 55%),
        radial-gradient(1000px 700px at 50% 95%, rgba(236,72,153,.18), transparent 55%),
        var(--bg);
      padding: 28px 14px 44px;
    }

    .wrap{
      max-width: 1100px;
      margin: 0 auto;
    }

    header{
      display:flex;
      gap:14px;
      align-items:flex-end;
      justify-content:space-between;
      margin-bottom: 16px;
    }

    .title{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .title h1{
      margin:0;
      font-size: clamp(22px, 3vw, 30px);
      letter-spacing: .2px;
    }
    .title p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }

    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 8px 12px;
      border: 1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
    }
    .dot{
      width:8px; height:8px; border-radius:50%;
      background: #22c55e;
      box-shadow: 0 0 18px rgba(34,197,94,.55);
    }

    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 14px;
    }
    @media (max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      header{ flex-direction:column; align-items:flex-start; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.045));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card .head{
      padding: 16px 16px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
    }

    .now{
      display:flex;
      flex-direction:column;
      gap:6px;
      min-width: 0;
    }
    .now .track{
      font-weight: 700;
      font-size: 14px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .now .sub{
      color: var(--muted);
      font-size: 12px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size: 12px;
    }

    .controls{
      padding: 14px 16px 16px;
      display:flex;
      flex-direction:column;
      gap: 12px;
    }

    .btnrow{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:space-between;
    }

    .btns{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    button{
      appearance:none;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--text);
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      display:inline-flex;
      gap:10px;
      align-items:center;
      font-weight: 650;
      font-size: 13px;
      letter-spacing:.1px;
    }
    button:hover{
      background: rgba(255,255,255,.09);
      border-color: rgba(255,255,255,.18);
    }
    button:active{ transform: translateY(1px); }
    button:disabled{
      opacity:.5;
      cursor:not-allowed;
    }

    .primary{
      background: rgba(99,102,241,.22);
      border-color: rgba(99,102,241,.35);
    }
    .primary:hover{
      background: rgba(99,102,241,.28);
      border-color: rgba(99,102,241,.45);
    }

    .icon{
      width: 16px;
      height: 16px;
      display:inline-block;
    }

    .seek{
      display:flex;
      flex-direction:column;
      gap: 8px;
    }

    input[type="range"]{
      width:100%;
      accent-color: #818cf8;
    }

    .time{
      display:flex;
      align-items:center;
      justify-content:space-between;
      color: var(--muted);
      font-size: 12px;
      gap: 10px;
    }

    .vol{
      display:flex;
      gap: 10px;
      align-items:center;
      justify-content:flex-end;
      color: var(--muted);
      font-size: 12px;
    }
    .vol input{ width: 160px; }
    @media (max-width: 520px){ .vol input{ width: 120px; } }

    .side{
      display:flex;
      flex-direction:column;
      min-height: 420px;
    }

    .toolbar{
      padding: 14px 16px 12px;
      border-bottom: 1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .search{
      flex: 1;
      min-width: 160px;
      display:flex;
      gap: 10px;
      align-items:center;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border: 1px solid var(--line);
    }

    .search input{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      color: var(--text);
      font-size: 13px;
    }
    .search input::placeholder{ color: rgba(255,255,255,.45); }

    .list{
      padding: 10px;
      overflow:auto;
      max-height: 520px;
    }
    @media (max-width: 900px){ .list{ max-height: 420px; } }

    .item{
      display:flex;
      align-items:center;
      gap: 12px;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid transparent;
      cursor:pointer;
      user-select:none;
      transition: background .12s ease, border-color .12s ease;
    }
    .item:hover{
      background: rgba(255,255,255,.06);
      border-color: rgba(255,255,255,.10);
    }
    .item.active{
      background: rgba(99,102,241,.18);
      border-color: rgba(99,102,241,.32);
    }

    .num{
      width: 28px;
      height: 28px;
      border-radius: 12px;
      display:grid;
      place-items:center;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--line);
      color: rgba(255,255,255,.8);
      font-weight: 700;
      font-size: 12px;
      flex: 0 0 auto;
    }

    .meta{
      min-width:0;
      flex:1;
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .meta .t{
      font-weight: 700;
      font-size: 13px;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .meta .m{
      color: var(--muted);
      font-size: 12px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }

    .empty{
      padding: 22px 12px;
      color: var(--muted);
      text-align:center;
    }

    footer{
      margin-top: 14px;
      color: rgba(255,255,255,.5);
      font-size: 12px;
      text-align:center;
    }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title">
      <h1>MP3 Player</h1>
      <p>Playlist diambil dari <code>/playlist.json</code>. File lagu diserve dari <code>/music/</code>.</p>
    </div>
    <div class="badge"><span class="dot"></span> Ready • Static Web</div>
  </header>

  <div class="grid">
    <!-- Player -->
    <section class="card">
      <div class="head">
        <div class="now">
          <div class="track" id="nowTitle">Tidak ada lagu</div>
          <div class="sub">
            <span class="pill" id="nowIndex">—</span>
            <span class="pill" id="nowStatus">Paused</span>
          </div>
        </div>
        <div class="pill" id="durPill">00:00</div>
      </div>

      <div class="controls">
        <div class="btnrow">
          <div class="btns">
            <button id="btnPrev" title="Prev">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M6 6v12M18 6l-8.5 6L18 18V6Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Prev
            </button>

            <button id="btnPlay" class="primary" title="Play">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M8 5v14l11-7L8 5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>
              Play
            </button>

            <button id="btnPause" title="Pause">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M7 5v14M17 5v14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              Pause
            </button>

            <button id="btnNext" title="Next">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M18 6v12M6 6l8.5 6L6 18V6Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Next
            </button>
          </div>

          <div class="vol">
            <span>Volume</span>
            <input id="vol" type="range" min="0" max="1" step="0.01" value="1" />
          </div>
        </div>

        <div class="seek">
          <input id="seek" type="range" min="0" max="1000" value="0" />
          <div class="time">
            <span id="time">00:00 / 00:00</span>
            <span id="hint">Tap lagu untuk mulai</span>
          </div>
        </div>

        <audio id="audio" preload="metadata"></audio>
      </div>
    </section>

    <!-- Playlist -->
    <aside class="card side">
      <div class="toolbar">
        <div class="search">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.3-4.3m1.8-5.2a7 7 0 11-14 0 7 7 0 0114 0Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <input id="q" placeholder="Cari judul..." />
        </div>
        <span class="pill" id="count">0 lagu</span>
      </div>

      <div class="list" id="list">
        <div class="empty">Loading playlist...</div>
      </div>
    </aside>
  </div>

  <footer>Tip: kalau kamu update lewat CLI, Vercel akan redeploy dan playlist otomatis ikut berubah.</footer>
</div>

<script>
  const audio = document.getElementById("audio");
  const seek = document.getElementById("seek");
  const vol  = document.getElementById("vol");

  const btnPrev  = document.getElementById("btnPrev");
  const btnPlay  = document.getElementById("btnPlay");
  const btnPause = document.getElementById("btnPause");
  const btnNext  = document.getElementById("btnNext");

  const listEl = document.getElementById("list");
  const qEl = document.getElementById("q");

  const nowTitle = document.getElementById("nowTitle");
  const nowIndex = document.getElementById("nowIndex");
  const nowStatus = document.getElementById("nowStatus");
  const timeEl = document.getElementById("time");
  const durPill = document.getElementById("durPill");
  const hint = document.getElementById("hint");
  const count = document.getElementById("count");

  let playlist = [];
  let filtered = [];
  let idx = -1;

  function fmt(sec){
    if (!isFinite(sec)) return "00:00";
    sec = Math.floor(sec);
    const m = String(Math.floor(sec/60)).padStart(2,"0");
    const s = String(sec%60).padStart(2,"0");
    return `${m}:${s}`;
  }

  function setStatus(text){
    nowStatus.textContent = text;
  }

  function updateHeader(){
    if (!filtered.length){
      nowTitle.textContent = "Playlist kosong";
      nowIndex.textContent = "—";
      durPill.textContent = "00:00";
      setStatus("Paused");
      btnPlay.disabled = true;
      btnPause.disabled = true;
      btnPrev.disabled = true;
      btnNext.disabled = true;
      return;
    }
    btnPlay.disabled = false;
    btnPause.disabled = false;
    btnPrev.disabled = false;
    btnNext.disabled = false;

    const t = filtered[idx];
    nowTitle.textContent = t.title || "Untitled";
    nowIndex.textContent = `${idx + 1} / ${filtered.length}`;
  }

  function render(){
    listEl.innerHTML = "";
    count.textContent = `${filtered.length} lagu`;

    if (!filtered.length){
      listEl.innerHTML = `<div class="empty">Tidak ada hasil.</div>`;
      return;
    }

    filtered.forEach((t, i) => {
      const div = document.createElement("div");
      div.className = "item" + (i === idx ? " active" : "");
      div.onclick = () => {
        setTrack(i);
        audio.play();
      };

      const num = document.createElement("div");
      num.className = "num";
      num.textContent = i + 1;

      const meta = document.createElement("div");
      meta.className = "meta";

      const title = document.createElement("div");
      title.className = "t";
      title.textContent = t.title || "Untitled";

      const m = document.createElement("div");
      m.className = "m";
      const url = document.createElement("span");
      url.textContent = t.url || "-";
      m.appendChild(url);

      meta.appendChild(title);
      meta.appendChild(m);

      div.appendChild(num);
      div.appendChild(meta);
      listEl.appendChild(div);
    });
  }

  function setTrack(i){
    if (!filtered.length) return;
    idx = (i + filtered.length) % filtered.length;
    const t = filtered[idx];
    audio.src = t.url;
    audio.load();
    hint.textContent = "Playing...";
    setStatus("Loading");
    updateHeader();
    render();
  }

  function applyFilter(){
    const q = (qEl.value || "").trim().toLowerCase();
    if (!q) filtered = [...playlist];
    else filtered = playlist.filter(t => (t.title || "").toLowerCase().includes(q));

    if (!filtered.length){
      idx = -1;
      audio.pause();
      audio.removeAttribute("src");
      audio.load();
      render();
      updateHeader();
      return;
    }

    // kalau sebelumnya ada track terpilih, coba pertahankan
    if (idx < 0) idx = 0;
    else if (idx >= filtered.length) idx = 0;

    // kalau audio belum ada source, set track
    if (!audio.src) setTrack(idx);
    else {
      updateHeader();
      render();
    }
  }

  async function loadPlaylist(){
    try{
      const res = await fetch("/playlist.json", { cache: "no-store" });
      if (!res.ok) throw new Error("Gagal fetch playlist.json");
      playlist = await res.json();

      // normalize minimal
      playlist = Array.isArray(playlist) ? playlist.map(x => ({
        title: x.title ?? "Untitled",
        url: x.url ?? "",
      })).filter(x => x.url) : [];

      applyFilter();
      if (filtered.length){
        setTrack(0);
        hint.textContent = "Tap Play atau klik judul";
      } else {
        hint.textContent = "Tambahkan lagu lewat CLI";
      }
    }catch(e){
      listEl.innerHTML = `<div class="empty">Gagal load playlist. Pastikan <code>/playlist.json</code> ada.</div>`;
      console.error(e);
    }
  }

  // controls
  btnPlay.onclick = () => audio.play();
  btnPause.onclick = () => audio.pause();
  btnPrev.onclick = () => { setTrack(idx - 1); audio.play(); };
  btnNext.onclick = () => { setTrack(idx + 1); audio.play(); };

  vol.addEventListener("input", () => audio.volume = Number(vol.value));

  audio.addEventListener("play", () => setStatus("Playing"));
  audio.addEventListener("pause", () => setStatus("Paused"));
  audio.addEventListener("ended", () => { setTrack(idx + 1); audio.play(); });

  audio.addEventListener("loadedmetadata", () => {
    durPill.textContent = fmt(audio.duration || 0);
  });

  audio.addEventListener("timeupdate", () => {
    const cur = audio.currentTime || 0;
    const dur = audio.duration || 0;
    const v = dur ? Math.floor((cur/dur) * 1000) : 0;
    seek.value = String(v);
    timeEl.textContent = `${fmt(cur)} / ${fmt(dur)}`;
  });

  seek.addEventListener("input", () => {
    const dur = audio.duration || 0;
    if (!dur) return;
    audio.currentTime = (Number(seek.value)/1000) * dur;
  });

  qEl.addEventListener("input", applyFilter);

  loadPlaylist();
</script>
</body>
    </html>
